<script type="text/discourse-plugin" version="0.8">
  const PLUGIN_ID = "discourse-custom-data-explorer-dropdown";

  // Register the component for query pages
  api.modifyClass("component:data-explorer-query", {
    pluginId: PLUGIN_ID,
    
    didInsertElement() {
      this._super(...arguments);
      this._checkAndHideParameter();
    },

    _checkAndHideParameter() {
      // Wait for DOM to be fully loaded with query parameters
      Ember.run.scheduleOnce('afterRender', this, () => {
        // Get current query ID
        const queryId = this.get('query.id');
        if (!queryId) return;
        
        // Get settings
        const targetQueryId = settings.target_query_id;
        const paramToHide = settings.parameter_to_hide;
        
        // Check if this is the target query
        if (parseInt(queryId, 10) !== parseInt(targetQueryId, 10)) {
          return;
        }
        
        // Check if param to hide is set
        if (!paramToHide) {
          return;
        }
        
        console.log(`${PLUGIN_ID}: Attempting to hide parameter ${paramToHide} for query ${targetQueryId}`);
        
        // Find and hide the parameter input
        const paramContainer = $(`#query-params-container .param-input[data-name="${paramToHide}"]`);
        if (!paramContainer.length) {
          console.error(`${PLUGIN_ID}: Could not find parameter input with name ${paramToHide}`);
          return;
        }
        
        // Hide the parameter container
        paramContainer.addClass('hidden-param-input');
        console.log(`${PLUGIN_ID}: Successfully hid parameter ${paramToHide}`);
      });
    }
  });
</script>

<style>
  .hidden-param-input {
    display: none !important;
  }
</style> 